<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuessFunc - 猜函数挑战</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- 引入 Math.js 用于数学表达式处理 -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <!-- 引入 Desmos API -->
    <script defer src="https://www.desmos.com/api/v1.10/calculator.js?apiKey=edcf0066d2ce4f71b4d898c660f42067&lang=zh-CN"></script>
    <!-- 引入 Compute Engine -->
    <script defer src="https://cdn.jsdelivr.net/npm/@cortex-js/compute-engine@0.26.2/dist/compute-engine.min.js"></script>
    
    <!-- 引入 Markdown 渲染 -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <!-- 引入 KaTeX 用于数学公式渲染 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css">
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/contrib/auto-render.min.js"></script>
    <!-- 引入 Crypto-JS 加密 -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="main-header">
            <h1>GuessFunc</h1>
            <div class="toolbar">
                <button id="btn-check" class="primary-btn">确认</button>
                <button id="btn-next" class="primary-btn hidden" style="display: none; background-color: #ff9800;">下一关</button>
                <button id="btn-return" class="hidden" style="display: none;">退出</button>
                <button id="btn-preset">预设</button>
                <button id="btn-random">随机</button>
                <button id="btn-create">创建</button>
                <button id="btn-share">分享</button>
                <button id="btn-options">选项</button>
            </div>
        </header>

        <div class="main-content">
            <div id="calculator" class="calculator-container"></div>
            <div id="message-area" class="message-area hidden">
                <span id="message-text"></span>
                <button id="btn-close-msg" class="close-btn">&times;</button>
            </div>
        </div>
    </div>

    <!-- 规则弹窗 -->
    <div id="modal-rules" class="modal hidden">
        <div class="modal-content wide">
            <span class="close-modal">&times;</span>
            <div id="rules-content" class="markdown-body">
                <!-- Content will be loaded here -->
                加载中...
            </div>
        </div>
    </div>

    <!-- 选项弹窗 -->
    <div id="modal-options" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>游戏选项</h2>
            <div class="options-menu">
                <button id="btn-rules" class="option-item">📜 规则说明</button>
                <button id="btn-export-save" class="option-item">💾 导出存档</button>
                <button id="btn-import-save" class="option-item">📂 导入存档</button>
                <button id="btn-clear-save" class="option-item" style="color: #f44336; border-color: #f44336;">🗑️ 清空存档</button>
            </div>
        </div>
    </div>

    <!-- 难度选择弹窗 -->
    <div id="modal-difficulty" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>选择难度</h2>
            <div class="difficulty-options">
                <button class="diff-btn" data-level="easy">简单 (基础函数)</button>
                <button class="diff-btn" data-level="medium">中等 (进阶函数)</button>
                <button class="diff-btn" data-level="hard">困难 (复杂嵌套)</button>
            </div>
        </div>
    </div>

    <!-- 关卡选择弹窗 -->
    <div id="modal-levels" class="modal hidden">
        <div class="modal-content wide">
            <span class="close-modal">&times;</span>
            <h2>选择关卡</h2>
            <div id="levels-list" class="levels-grid">
                <!-- Levels will be injected here -->
            </div>
        </div>
    </div>

    <!-- 关卡指引弹窗 -->
    <div id="modal-level-instruction" class="modal hidden">
        <div class="modal-content wide">
            <span class="close-modal">&times;</span>
            <div id="level-instruction-content" class="markdown-body"></div>
            <div style="margin-top: 20px; text-align: right;">
                <button id="btn-start-level" class="primary-btn">开始挑战</button>
            </div>
        </div>
    </div>

    <!-- 脚本引入 (顺序很重要) -->
    <script src="js/debug_config.js"></script>
    <script src="js/levels.js"></script>
    <script src="js/storage_manager.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/math_engine.js"></script>
    <script src="js/graph_manager.js"></script>
    <script src="js/ui_manager.js"></script>
    <script src="js/game_logic.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
